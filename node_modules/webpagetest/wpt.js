//api key :A.81570d0c6da5ed737e21f766e7a89655


var fs = require('fs');
var WebPageTest = require('webpagetest');
var wpt = new WebPageTest('www.webpagetest.org', 'A.81570d0c6da5ed737e21f766e7a89655');

var quiche = require('quiche');
var chart = quiche('line');

chart.setTitle('Something with lines');
chart.addData([3000, 2900, 1500], 'Blah', '008000');
chart.addData([1000, 1500, 2000], 'Asdf', '0000FF');
chart.addAxisLabels('x', ['1800', '1900', '2000']);
chart.setAutoScaling();
chart.setTransparentBackground();

var imageUrl = chart.getUrl(true);




var WebPageTest = require('webpagetest');

var wpt = new WebPageTest('www.webpagetest.org', 'A.81570d0c6da5ed737e21f766e7a89655');

wpt.createVideo('150810_QS_TDG,150810_G3_TFE', {"dryRun":true}, function callback(err, data) {
	console.log("createvideo");
  console.log(err || data);
});

//tests=150810_7Q_MD4,150810_X8_MD5
// wpt.runTest('www..com', { "video":true,"player":true, breakdown: true, domains: true, pageSpeed: true, requests: true}, function(err, aData) {
// 	console.log(aData);
// 	var mTestId = aData.data.testId;
// 	console.log(mTestId);
// 	var isCheck = true;
// 	// createVideo(mTestId);
// 	result(mTestId, callback);
// });			


// wpt.createVideo(, {"dryRun":true}, function callback(err, data) {
//   console.log(err || data);
// });

// var createVideo = function(aId) {
// 	wpt.createVideo(aId, {"comparisonEndPoint":"full"} , function(error, data) {
// 		console.log('createVideo');
// 		console.log(data);
// 	}); 	
// }

var callback = function(aId, status) {
	if(status == true) {
		// getWaterfallImg(aId);
		// getScreenshotImg(aId);
		//getEmbedVideoPlayer(aId);
		
	}
}
var result = function(aId, callback) {
	wpt.getTestResults(aId, { breakdown: true, requests: true}, function(err, data) {
	console.log(data.data.statusCode);
		if(data.statusCode == 200) {
			callback(aId,true);
			console.log('firstView');
			console.log(data.data.median.firstView);
			console.log('repeatView');
			console.log(data.data.median.repeatView);
		} else {
			result(aId, callback);
		}	
	});
}


// var getEmbedVideoPlayer = function(aId) {
// 	wpt.getEmbedVideoPlayer(aId, function (err, aData) {
// 		console.log('getEmbedVideoPlayer');
// 		console.log(err || data);
//   		// fs.writeFile('video', aData, function(err) {
//     // 		console.log('video');
//   		// });
// 	});	
// }
var getWaterfallImg = function(aId) {
	wpt.getWaterfallImage(aId, { chartWidth: 640, mime:true, colorByMime: true }, function (err, aData) {
  		fs.writeFile('b.png', aData, function(err) {
    		// console.log('File write completed');
  		});
	});	
}

var getScreenshotImg = 	function(aId) {
	wpt.getScreenshotImage(aId, {thumbnail: true, repeatView: true}, function (err, aData) {
		console.log('screentshot');
		console.log(aData);
		fs.writeFile('a.png', aData, function(err) {
	    	// console.log('File write completed');
		});
	});
}
